<%inherit file="base.mako.html"/>

<%block name="title">
    Litestar HTMX Fullstack With Mako
</%block>

<%block name="header">
    ${parent.header()}
    Author
</%block>


<%block name="intro">
    intro
</%block>
<button onclick="document.getElementById('dialogNew').showModal();">Add New</button>
<dialog id="dialogNew" class="dialog">
    <h4>New Author</h4>

    <form>
        <div>
            <div>
                Name:
                <input type="text" name="name" value="">
            </div>
            <div>
                Date Of Birth:
                <input type="date" name="dob" value="">
            </div>
            <div>
                <button id="closeNew" class="close" onclick="document.getElementById('dialogNew').close();">close</button>
                <button hx-post="new"
                    hx-swap="beforebegin"
                    hx-ext="json-enc"
                    hx-target=".authorListing tr:first-child"
                    onclick="document.getElementById('dialogNew').close();"
                >
                Save</button>

            </div>
        </div>
    </form>
    <script>
        /* need to prevent the default action otherwise the URL parameters are screwed up */
        document.getElementById("closeNew").addEventListener("click", function(event){
            event.preventDefault()
        });
    </script>
</dialog>
<table border="1">
    <caption>
        List Of Authors
    </caption>
    <thead>
        <tr><th><input type="checkbox" name="master-check"></th><th></th><th>Name</th><th>dob</th><th>id</th></tr>
    </thead>
    <tbody class="authorListing">
        % for author in site_data.items:
            <tr>
                <td><input type="checkbox" name="id" value="${author.id}"></td>
                <td><button hx-get="edit/${author.id}" hx-swap="outerHTML" title="edit ${author.id}" hx-target="closest td">edit</button></td>
                <td>
                    ${author.name}
                </td>
                <td>
                    % if author.dob:
                        ${author.dob.strftime('%Y-%m-%d')}
                    % endif
                </td>
                <td>
                    ${author.id}
                </td>
            </tr>
        % endfor
    </tbody>
</table>
<div>
    <h5>Pages</h5>
    <a href="listing?currentPage=1&pageSize=1">1</a>
    <a href="listing?currentPage=2&pageSize=1">2</a>
    <a href="listing?currentPage=3&pageSize=1">3</a>
</div>